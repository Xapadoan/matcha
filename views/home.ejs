<!DOCTYPE html>
<html lang="en">
<%- include('head.ejs'); %>

<body>
	<style>
		#home_forms {
			height: 650px;
			overflow-y: auto;
		}

		#user_infos {
			margin-top: 0px;
		}

		#user_infos, #update_location, #new_photo {
			width: calc(40vw - 25px);
		}

		#user_images {
			background-color: rgba(160, 160, 160, 0.4);
			border-radius: 20px;
			text-align: center;
		}

		#user_images figure {
			margin: 0px;
			display: inline-block;
		}

		.public_profile_mini p {
			margin-left: 20px;
			display: inline-block;
		}

		#likesnmatches img {
			float: right;
		}

		.public_profile_mini {
			display: inline-block;
			border: 2px solid #f00;
			background-size: cover;
			width: 400px;
			height: 550px;
			color: white;
			text-shadow: 0 0 10px black;
			position: relative;
		}

		.public_profile_mini .bio {
			margin-left: 0px;
			position: absolute;
			width: 390px;
			max-height: 300px;
			bottom: 0px;
			left: 0px;
			white-space: normal;
		}

		.button {
			position: absolute;
		}

		#likesnmatches {
			background-color: rgba(160, 160, 160, 0.4);
			border-radius: 20px;
			padding-bottom: 20px;
			width: calc(60vw - 60px);
			height: 650px;
			position: absolute;
			right: 20px;
			top: 0px;
			margin: 0px;
			text-align: center;
			overflow-x: auto;
			white-space: nowrap;
		}

		.user_img {
			max-height: 330px;
			width: auto;
			height: auto;
		}

		@media screen and (max-width: 850px) {
			#likesnmatches, #user_images {
				position: static;
				margin: 3px 0px;
				width: 100vw;
				margin-left: 0px;
				margin-top: 0px;
				overflow-y: auto;
			}

			#user_infos, #update_location, #new_photo {
				padding: 5vw;
				width: 90vw;
				margin-left: 0px;
			}

			.public_profile_mini {
				margin-top: 5px;
				display: block;
				width: 400px;
				height: 500px;
				left: calc(50% - 200px);
			}

			.public_profile_mini .bio {
				width: 400px;
			}
		}

		@media screen and (max-width: 420px) {
			#search_filters {
				margin: auto;
			}

			#likesnmatches, #user_images {
				width: 100vw;
				margin-left: 0px;
				margin-top: 0px;
				overflow-y: auto;
			}

			.public_profile_mini {
				margin-top: 5px;
				display: block;
				width: 300px;
				height: 325px;
				left: calc(50% - 150px);
			}

			.public_profile_mini .bio {
				width: 300px;
			}
		}
	</style>
	<%- include('header.ejs') %>
	<section id='home_forms'>
	<form id='user_infos' method="POST" name='user_infos' action='/update'>
		<h1><%= user %></h1>
		<input name='Firstname' type="text" maxlength="100" minlength="1"
			<% if (typeof locals.user_info != 'undefined') { %> value='<%= user_info.firstname %>' <% } else { %>
			placeholder="Firstname" <% } %> />
		<input name='Lastname' type="text" maxlength="100" minlength="1"
			<% if (typeof locals.user_info != 'undefined') { %> value='<%= user_info.lastname %>' <% } else { %>
			placeholder="Lastname" <% } %> />
		<input name='Mail' type="email" maxlength="100" minlength="5"
			<% if (typeof locals.user_info != 'undefined') { %> value='<%= user_info.email %>' <% } else { %>
			placeholder="E-Mail" <% } %> />
		<input name='Password' type='password' maxlength="32" minlength="1" placeholder="Password" />
		<br />
		<h3>Fruit: </h3>
		<%- include('fruits.ejs') %>
		<label for='Age'>Age : </label><input name="Age" type='number' size=2
			<% if (typeof locals.user_info != 'undefined' && locals.user_info != null) { %>
			value=<%= user_info.age %> <% } else { %> value=20 <% } %> max="77" min='18' /><br />
		<label for='Gender'>Gender : </label>
		<select name="Gender">
			<option value="Both"
				<% if (typeof locals.user_info != 'undefined' && locals.user_info.gender == 'Both') { %>
				selected <% } %>>Both</option>
			<option value="Woman"
				<% if (typeof locals.user_info != 'undefined' && locals.user_info.gender == 'Woman') { %>
				selected <% } %>>Woman</option>
			<option value="Man"
				<% if (typeof locals.user_info != 'undefined' && locals.user_info.gender == 'Man') { %> selected
				<% } %>>Man</option>
		</select><br />
		<label for='Orientation'>Orientation : </label>
		<select name="Orientation">
			<option value="Both"
				<% if (typeof locals.user_info != 'undefined' && locals.user_info.orientation == 'Both') { %>
				selected <% } %>>Both</option>
			<option value="Women"
				<% if (typeof locals.user_info != 'undefined' && locals.user_info.orientation == 'Women') { %>
				selected <% } %>>Women</option>
			<option value="Men"
				<% if (typeof locals.user_info != 'undefined' && locals.user_info.orientation == 'Men') { %>
				selected <% } %>>Men</option>
			<option value="Trans"
				<% if (typeof locals.user_info != 'undefined' && locals.user_info.orientation == 'Trans') { %>
				selected <% } %>>Transexual</option>
		</select><br />
		<label for='Bio'>Bio : </label><br />
		<textarea name='Bio' form="user_infos"><% if (typeof locals.user_info != 'undefined' && locals.user_info.bio != null) {
			%><%= user_info.bio %><% } %></textarea>
		<input type="hidden" name="_csrf" value=<%= csrfToken %> />
		<button>Update profile</button>
	</form>
	<form method="POST" id='new_photo' name="new_photo" action='/new_photo' enctype="multipart/form-data">
		Picture : <input type="file" name="image" />
		<input type="hidden" name="_csrf" value=<%= csrfToken %> />
		<button>OK</button>
	</form>
	<form method="POST" id='update_location' name='update_location' action="/update_location">
		<p>Where are you now ?<br />We will find people near you</p>
		<input type='text' name='street' placeholder="Street name" /><br />
		<input type='text' name='city' placeholder="City name" /><br />
		Country : <select name='country'>
			<option value="BE">Belgique</option>
			<option value='CA'>Canada</option>
			<option value="DE">Deutschland</option>
			<option value="EN">England</option>
			<option value='FR' selected>France</option>
			<option value='US'>United States</option>
		</select>
		<input type="hidden" name="_csrf" value=<%= csrfToken %> />
		<button>Update</button>
	</form>
	<% if (typeof locals.user != 'undefined') { %>
		<a href="/delete_user" >Delete Account</a>
	<% } %>
	</section>
	<% if (typeof locals.images != 'undefined' && locals.images.image1 != null) { %>
	<section id='user_images'>
		<h2>Your pictures</h2>
		<% if (locals.images.image1 != null) { %>
		<figure>
			<a href="/delete_image/1" title="Delete"><img class='button' src='/dump.png' alt='delete_icon'></a>
			<img src="/user_images/<%= images.image1 %>" class='user_img' alt='profile_picture' title='profile_picture' />
		</figure>
		<% }
		if (locals.images.image2 != null) { %>
		<figure>
			<a href="/delete_image/2" title="Delete"><img class='button' src='/dump.png'></a>
			<img src="/user_images/<%= images.image2 %>" class='user_img' />
		</figure>
		<% }
		if (locals.images.image3 != null) { %>
		<figure>
			<a href="/delete_image/3" title="Delete"><img class='button' src='/dump.png'></a>
			<img src="/user_images/<%= images.image3 %>" class='user_img' />
		</figure>
		<% }
		if (locals.images.image4 != null) { %>
		<figure>
			<a href="/delete_image/4" title="Delete"><img class='button' src='/dump.png'></a>
			<img src="/user_images/<%= images.image4 %>" class='user_img' />
		</figure>
		<% }
		if (locals.images.image5 != null) { %>
		<figure>
			<a href="/delete_image/5" title="Delete"><img class='button' src='/dump.png'></a>
			<img src="/user_images/<%= images.image5 %>"  class='user_img' />
		</figure>
		<% } %>
	</section>
	<% } %>
	<% if (typeof locals.profiles != 'undefined' && locals.profiles.length > 0) { %>
	<section id='likesnmatches'>
		<h2>You liked:</h2>
			<% for (var i in locals.profiles) { %>
			<style>
				#user<%=profiles[i].id %> {
					background-image: url('user_images/<%= profiles[i].image1 %>');
				}
			</style>
			<article id='user<%= profiles[i].id %>' class='public_profile_mini'>
				<p>
					<a href='/profile/<%= profiles[i].id %>' title='See profile'>
						<%= profiles[i].firstname %> <%= profiles[i].lastname %>
					</a>, <%= profiles[i].age %>
				</p>
				<p>(<%= profiles[i].gender %>)</p><br />
				<% switch (profiles[i].fruit) {
                        case ('#JustHangingOut'): %>
				<img src='coconut.png' height="75" width="75" title="#JustHangingOut" />
				<% break;
                    case ('#BootyCall'): %>
				<img src='peach.png' height="75" width="75" title="#BootyCall" />
				<% break;
                    case ('#SeriousRelationship'): %>
				<img src='cherry.png' height="75" width="75" title="#SeriousRelationship" />
				<% break;
                    case ('#SexFriends'): %>
				<img src='ginger.png' height="75" width="75" title="#SexFriends" />
				<% break;
					} %>
				<p id='address<%= profiles[i].id %>'> </p>
				<% if (typeof locals.profiles[i].lat != 'undefined' && locals.profiles[i].lat != null && typeof locals.profiles[i].lng != 'undefined' && locals.profiles[i].lng != null) { %>
					<script>
						get('/get_address/<%= profiles[i].lat %>/<%= profiles[i].lng %>', null, document.getElementById('address<%= profiles[i].id %>'), (anchor, data) => {
							if (data.city != undefined && data.country != undefined) {
								anchor.innerText = data.city + ', ' + data.country;
							}
						});
					</script>
				<% } %>
				<p class='bio'><%= profiles[i].bio %></p>
			</article>
			<% } %>
	</section>
	<% } %>

</body>

</html>